{"version":3,"file":"lattice-connector.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\r\nimport { AbstractConnector } from '@web3-react/abstract-connector'\r\nimport Web3ProviderEngine from 'web3-provider-engine'\r\nimport { LatticeSubprovider } from '@0x/subproviders/lib/src/subproviders/lattice'\r\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\r\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\r\n\r\ninterface LatticeConnectorArguments {\r\n  chainId: number\r\n  url: string\r\n  pollingInterval?: number\r\n  requestTimeoutMs?: number\r\n  appName: string\r\n}\r\n\r\nexport class LatticeConnector extends AbstractConnector {\r\n  private readonly chainId: number\r\n  private readonly url: string\r\n  private readonly pollingInterval?: number\r\n  private readonly requestTimeoutMs?: number\r\n  private readonly appName: string\r\n  private provider: any\r\n\r\n  constructor({ chainId, url, pollingInterval, requestTimeoutMs, appName }: LatticeConnectorArguments) {\r\n    super({ supportedChainIds: [chainId] })\r\n\r\n    this.chainId = chainId\r\n    this.url = url\r\n    this.pollingInterval = pollingInterval\r\n    this.requestTimeoutMs = requestTimeoutMs\r\n    this.appName = appName\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    if (!this.provider) {\r\n      const LatticeKeyring = await import('eth-lattice-keyring').then(m => m?.default ?? m)\r\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\r\n      const opts = {\r\n        appName: this.appName,\r\n        latticeConnectClient: LatticeKeyring,\r\n        networkId: this.chainId\r\n      }\r\n      engine.addProvider(new LatticeSubprovider(opts))\r\n      engine.addProvider(new CacheSubprovider())\r\n      engine.addProvider(new RPCSubprovider(this.url, this.requestTimeoutMs))\r\n      this.provider = engine\r\n    }\r\n\r\n    this.provider.start()\r\n\r\n    return { provider: this.provider, chainId: this.chainId }\r\n  }\r\n\r\n  public async getProvider(): Promise<Web3ProviderEngine> {\r\n    return this.provider\r\n  }\r\n\r\n  public async getChainId(): Promise<number> {\r\n    return this.chainId\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return this.provider._providers[0].getAccountsAsync(1).then((accounts: string[]): string => accounts[0])\r\n  }\r\n\r\n  public deactivate() {\r\n    this.provider.stop()\r\n  }\r\n\r\n  public async close(): Promise<null> {\r\n    this.emitDeactivate()\r\n    // Due to limitations in the LatticeSubprovider API, we use this code with `getAccounts`\r\n    // as a hack to allow us to close out the connection and forget data.\r\n    // It will get handled in `eth-lattice-keyring`, which will forget the device and return\r\n    // an empty array (whose first element will be null/undefined)\r\n    const CLOSE_CODE = -1000\r\n    return this.provider._providers[0].getAccountsAsync(CLOSE_CODE).then((accounts: string[]): string => accounts[0])\r\n  }\r\n}\r\n"],"names":["chainId","url","pollingInterval","requestTimeoutMs","appName","supportedChainIds","activate","this","provider","start","_this3","then","m","LatticeKeyring","engine","Web3ProviderEngine","addProvider","LatticeSubprovider","latticeConnectClient","networkId","CacheSubprovider","RPCSubprovider","getProvider","getChainId","getAccount","_providers","getAccountsAsync","accounts","deactivate","stop","close","emitDeactivate","AbstractConnector"],"mappings":"8fAuBgBA,IAAAA,QAASC,IAAAA,IAAKC,IAAAA,gBAAiBC,IAAAA,iBAAkBC,IAAAA,6BACvD,CAAEC,kBAAmB,CAACL,YAEvBA,QAAUA,IACVC,IAAMA,IACNC,gBAAkBA,IAClBC,iBAAmBA,IACnBC,QAAUA,+GAGJE,8BACNC,2BAcAC,SAASC,QAEP,CAAED,SAAUE,EAAKF,SAAUR,QAASU,EAAKV,2BAhB3CU,EAAKF,gCACqB,8QAAO,4BAAuBG,MAAK,SAAAC,+BAAKA,SAAAA,aAAcA,qBAA7EC,OACAC,EAAS,IAAIC,EAAmB,CAAEb,gBAAiBQ,EAAKR,kBAM9DY,EAAOE,YAAY,IAAIC,qBALV,CACXb,QAASM,EAAKN,QACdc,qBAAsBL,EACtBM,UAAWT,EAAKV,WAGlBc,EAAOE,YAAY,IAAII,GACvBN,EAAOE,YAAY,IAAIK,iBAAeX,EAAKT,IAAKS,EAAKP,qBAChDK,SAAWM,8FAQPQ,kDACJf,KAAKC,gDAGDe,iDACJhB,KAAKP,+CAGDwB,iDACJjB,KAAKC,SAASiB,WAAW,GAAGC,iBAAiB,GAAGf,MAAK,SAACgB,UAA+BA,EAAS,6CAGhGC,WAAA,gBACApB,SAASqB,UAGHC,4BACXvB,KAAKwB,iCAALxB,KAMYC,SAASiB,WAAW,GAAGC,kBADf,KAC4Cf,MAAK,SAACgB,UAA+BA,EAAS,8CA7D5EK"}